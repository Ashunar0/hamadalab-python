# ノートブック評価サマリー

**日付:** 2026-01-10
**比較対象:** `asao_step0_1219-with_features.ipynb` (旧) vs. `asao_step0_1310-with_features_total_19.ipynb` (新)

## 1. 概要
本ドキュメントは、プロジェクトノートブックの2つのバージョンにおけるアンサンブルモデル（調整済みRandomForest + XGBoost + LightGBM）の性能評価をまとめたものです。新しいノートブック（`1310`）では追加の特徴量が組み込まれており、特に **SI（シンカー）と FF（4シーム）の識別精度** において顕著な改善が見られます。

## 2. モデル性能指標 (全体)

| 指標 | `asao_step0_1219` | `asao_step0_1310` | 変化 |
| :--- | :--- | :--- | :--- |
| **検証データ正解率 (Accuracy)** | 0.905 | **0.906** | +0.001 |
| **検証データF1スコア (weighted)** | 0.904 | **0.905** | +0.001 |

## 3. 重点分析: SI (シンカー) の誤分類改善

ユーザー提供の混同行列データに基づき、課題であった SI の誤分類（特に FF への誤認）がどの程度改善されたかを分析しました。

### **SI (シンカー) の誤分類数比較**

| 誤分類先 (Predicted) | 旧モデル (`1219`) | 新モデル (`1310`) | 改善数 (減少数) | 改善率 |
| :--- | :--- | :--- | :--- | :--- |
| **FF (4-Seam Fastball)** | **2,430球** | **1,619球** | **-811球** | **33.4% 減少** |
| **CH (Changeup)** | 729球 | 496球 | -233球 | 32.0% 減少 |
| **FC (Cutter)** | 55球 | 33球 | -22球 | 40.0% 減少 |

**考察:**
*   最も懸念されていた **SI を FF と間違えるケースが約 33% 減少** しました。これは非常に大きな改善です。
*   CH（チェンジアップ）や FC（カッター）への誤認も同様に 30-40% 減少しており、モデルが SI の特徴（おそらく垂直方向の変化 `pfx_z` や球速 `release_speed`）をより正確に捉えられるようになったことを示唆しています。

## 4. 詳細な分類レポート (Classification Reports)

### ノートブック: `asao_step0_1219-with_features.ipynb`
```
              precision    recall  f1-score   support

          CH       0.92      0.95      0.94     23065
          CU       0.88      0.87      0.87     14074
          EP       0.85      0.89      0.87       167
          FA       0.89      0.82      0.85       334
          FC       0.82      0.76      0.79     16796
          FF       0.96      0.97      0.97     68198
          FO       0.83      0.75      0.79       230
          FS       0.87      0.74      0.80      4759
          KC       0.88      0.69      0.78      4410
          KN       0.93      0.93      0.93        58
      Others       0.73      0.29      0.41        56
          SI       0.94      0.93      0.94     32821
          SL       0.83      0.87      0.85     34122
          ST       0.83      0.86      0.84     12405
          SV       0.84      0.69      0.76       843

    accuracy                           0.91    212338
   macro avg       0.87      0.80      0.83    212338
weighted avg       0.90      0.91      0.90    212338
```

### ノートブック: `asao_step0_1310-with_features_total_19.ipynb`
```
              precision    recall  f1-score   support

          CH       0.93      0.95      0.94     23065
          CU       0.88      0.87      0.87     14074
          EP       0.88      0.87      0.88       167
          FA       0.89      0.84      0.86       334
          FC       0.82      0.76      0.79     16796
          FF       0.96      0.97      0.97     68198
          FO       0.83      0.70      0.76       230
          FS       0.87      0.75      0.81      4759
          KC       0.86      0.69      0.77      4410
          KN       0.85      0.88      0.86        58
      Others       0.71      0.39      0.51        56
          SI       0.94      0.94      0.94     32821
          SL       0.83      0.87      0.85     34122
          ST       0.83      0.85      0.84     12405
          SV       0.80      0.67      0.73       843

    accuracy                           0.91    212338
   macro avg       0.87      0.80      0.83    212338
weighted avg       0.90      0.91      0.90    212338
```

## 5. その他の観測された違い

*   **EP (Ephus / イーファス):** 新しいモデルで適合率（Precision）が向上 (0.85 -> 0.88)。
*   **FO (Forkball / フォーク):** 新しいモデルで再現率（Recall）が低下 (0.75 -> 0.70)。
*   **KN (Knuckleball / ナックル):** 適合率が低下 (0.93 -> 0.85) したが、サンプルサイズ小。

## 6. 次のステップ & 改善提案 (Next Steps)

これまでの分析とノートブックの内容に基づき、以下のステップを提案します。

1.  **特徴量重要度 (SHAP) の詳細分析:**
    *   `1310` ノートブックでは SHAP の導入が試みられていますが、特に **誤分類されたケース（Worst Cases）** に焦点を当てた特徴量分析を深めることで、モデルがなぜ間違えたのか（例：特定の軌道や回転数の組み合わせが影響しているか）を特定できます。

2.  **モデルの過信 (Overconfidence) への対策:**
    *   `1219` ノートブックの末尾で「予測確率が高いのに間違っている」ケースが指摘されています（例：確率0.9以上での誤分類）。
    *   モデルの予測確率を較正 (Calibration) するか、過信しているサンプルの特徴を洗い出す必要があります。

3.  **マイナークラス (FO, SV) の精度向上:**
    *   SI/FF は改善しましたが、FO (フォーク) や SV (スプリット) などのサンプル数が少ない球種の Recall がまだ低めです。
    *   これらに対するデータ拡張（Augmentation）や、クラス重み（Class Weights）の調整を検討する余地があります。

4.  **XGBoost / RandomForest のチューニング:**
    *   現在は LightGBM が重点的にチューニングされているようです。他のモデルのハイパーパラメータをさらに最適化することで、アンサンブル全体の精度底上げが期待できます。

