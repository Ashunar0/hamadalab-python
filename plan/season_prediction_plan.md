## テーマ案：過去 3 年から翌年成績を予測する「来季活躍予測」プロジェクト

### 1. 企画のねらい

- **目的**
  - `pybaseball` で取得できる実際のシーズン成績を使い、  
    **「2022〜2024 年の成績を入力として 2025 年の成績を予測し、どれくらい当たるか検証する」**。
- **ねらい**
  - 「機械学習で“未来を当てる”」という分かりやすいテーマで、モチベーションを上げる。
  - ただし難しそうに見えるので、**中身はできるだけシンプルな回帰 / 分類問題に落とし込む**。
  - `beginner.ipynb` / `professional.ipynb` でやった流れ（EDA → 前処理 → モデル → 評価）を、  
    **「時系列（年度）」という要素が入ったデータに応用する経験**をする。

---

### 2. 予測タスクの具体案

**基本アイデア**: 「選手ごとに “過去 3 年の成績” を 1 行にまとめ、それを特徴量として “翌年の成績” を予測する」。

#### 2.1 打者の来季成績予測（メイン案）

- **入力（特徴量の例）** ＝ 2022〜2024 年の打撃成績
  - 各年の打席数（PA）、打率、出塁率、長打率、OPS、HR、本塁打率、三振率、四球率 など
  - 年齢（2024 年時点）、ポジション（内野 / 外野 / 捕手など、最初は削ってもよい）
  - 「過去 3 年平均 OPS」や「OPS の増減（2024−2023、2023−2022）」などの簡単な要約指標
- **出力（予測したいものの例）**
  1. **回帰問題**：2025 年の OPS（もしくは HR 本数、wOBA など）を数値として予測
     - 評価指標：平均二乗誤差（MSE）、平均絶対誤差（MAE）など
  2. **分類問題**：
     - 「2025 年に ‘強打者’（リーグ平均 OPS より上）かどうか」を 0/1 で予測
       - 評価指標：正解率（accuracy）、必要なら F1 など
     - あるいは「2025 年の OPS が過去 3 年平均より **明らかに上がるか/下がるか**」を 0/1 で予測
       - 「ブレイクするか・劣化するか」を当てるイメージで、ストーリー性が出る

#### 2.2 投手版（サブ案）

- 打者版と同じ枠組みで、
  - 入力：2022〜2024 年の ERA、FIP、K/9、BB/9、WHIP、イニング数など
  - 出力：2025 年の ERA（回帰）や、「リーグ平均より良い投手かどうか」（分類）
- 時間があれば「打者チーム」「投手チーム」に分かれて並行して進めてもよい。

---

### 3. 分析の流れ（年度データ版 `beginner.ipynb`）

基本の型は `beginner.ipynb` と同じで、**「年次データを選手ごとにまとめる」手順が追加される**イメージ。

#### 3.0 ライブラリ・データ読み込み

- **やること**
  - `pybaseball`, `pandas`, `numpy`, `matplotlib`, `seaborn`, `scikit-learn` をインポート。
  - `pybaseball.batting_stats(2022)`, `batting_stats(2023)`, `batting_stats(2024)`, `batting_stats(2025)` などでシーズン成績を取得。
  - **選手を識別するキー（playerid など）** を使って、年度をまたいで同じ選手を追える形にする。
  - 最初は **1 リーグだけ or 打席数が一定以上の選手だけ** に絞るなどして、データ量を減らす。
- **理解ポイント**
  - Titanic の `train.csv` は「1 年分で完結」していたが、今回は「複数年分を組み合わせた自作の train データ」を作るイメージ。

#### 3.1 データの整形（年度の縦持ち → 横持ち）

- **やること**
  - 「2022 年の成績」「2023 年の成績」「2024 年の成績」を、選手ごとに横に結合して 1 行にまとめる。
    - 例：`OPS_2022`, `OPS_2023`, `OPS_2024`, `HR_2022`, `HR_2023`, `HR_2024`, `Age_2024` などのカラムを持つ 1 行。
  - 目的変数として「2025 年の OPS（や HR）」を同じ行にくっつける。
  - 2025 年に出場していない（出場が極端に少ない）選手は、予測の評価が難しいので最初は除外する。
- **理解ポイント**
  - 「時系列データを ‘特徴量としてまとめる’」という初歩的な時系列 → 表形式の変換を体験できる。

#### 3.2 EDA（探索的データ分析）

- **やること**
  - `df.shape`, `df.head()`, `df.isnull().sum()` で基本チェック。
  - 打者の 2025 年 OPS の分布を見て、「だいたいどのくらいの値が多いか」を確認。
  - 「過去 3 年平均 OPS」と「2025 年 OPS」の散布図を描き、**単純平均でもそこそこ当たりそうか？** を目で見る。
  - 相関ヒートマップで、「2025 年 OPS」と相関が高い説明変数を眺める。
- **Titanic との対応**
  - 生存率円グラフ → OPS や HR の分布。
  - 相関ヒートマップはそのまま流用イメージ。

#### 3.3 前処理・特徴量作成

- **やること（初心者向けにシンプルに）**
  - 欠損の多いマイナーな指標は削除。
  - 文字列（チーム名・ポジションなど）は、最初のバージョンでは削除してしまう（`beginner.ipynb` と同じ方針）。
  - 基本となる特徴量を作成：
    - `OPS_mean_3y` = 2022〜2024 年の OPS の平均
    - `OPS_trend` = 2024 OPS − 2022 OPS など、ざっくりした増減
    - 同様に HR、本塁打率、PA などでも平均や増減を作ってみる
  - 目的変数の作成：
    - 回帰：`y = OPS_2025`
    - 分類：`Strong_2025 = (OPS_2025 >= OPS_2025_median).astype(int)`
- **理解ポイント**
  - 「特徴量エンジニアリングといっても、最初は ‘過去の平均と増減を見る’ 程度からで良い」という感覚を持てる。

---

### 4. モデル構築・学習・評価

#### 4.1 ベースラインモデル（単純なルール）

- **やること**
  - 機械学習の前に、**単純なルールによる予測**を用意して比較ベースラインにする。
    - 例：`予測 OPS_2025 = 過去 3 年平均 OPS`
  - 実際の `OPS_2025` と比べ、MAE などで「どれくらいズレたか」を計算。
- **理解ポイント**
  - 「機械学習モデルが偉いかどうかは、**単純なルールを超えられるかどうか**で判断する」という考え方。

#### 4.2 機械学習モデル（回帰 / 分類）

- **やること**
  - 説明変数 `X` と 目的変数 `y` を準備。
  - `train_test_split` で学習用・評価用に分割（7:3 など）。
  - シンプルなモデルから試す：
    - 回帰なら `LinearRegression` / `RandomForestRegressor`
    - 分類なら `LogisticRegression` / `RandomForestClassifier`
  - 学習 (`fit`) して、評価用データで MAE / accuracy を計算。
  - ベースライン（過去 3 年平均）と精度を比較する。
- **理解ポイント**
  - 「モデルを複雑にする前に、まずはシンプルなモデルでベースラインを超えられるか」を見る。
  - `beginner.ipynb` のロジスティック回帰と操作はほぼ同じ。

#### 4.3 誤差分析・ケーススタディ

- **やること**
  - 「予測と実際が大きくズレた選手」をいくつかピックアップする。
    - 予測より実際が大きく良かった選手（ブレイク組）
    - 予測より実際が悪かった選手（劣化組）
  - その選手たちについて、成績推移やニュース（ケガ・移籍・スタメン起用など）を調べて、  
    **「なぜモデルは外したか？」を野球的に考察**する。
- **理解ポイント**
  - 「当たった / 外れた」だけでなく、**どこで、なぜ外れたのか**を考えることで、機械学習の限界や改良案をイメージできる。

---

### 5. 段階的な進め方（難易度コントロール）

1. **ステップ 1（最低限ここまで）**
   - 打者に限定、指標も 5〜10 個程度に絞る。
   - 特徴量：過去 3 年平均 OPS と OPS_trend 程度。
   - タスク：回帰 or 0/1 分類どちらか一方。
   - モデル：線形回帰 or ロジスティック回帰 1 種類だけ。
2. **ステップ 2（余裕があれば）**
   - 特徴量を少し増やす（HR、BB%、K%、PA など）。
   - ランダムフォレストなど、もう 1 種類モデルを追加して性能比較。
3. **ステップ 3（時間もやる気も十分な場合）**
   - 投手版も作って比較。
   - 2018〜2020 で 2021 を予測する…など、**過去のシーズンでバックテスト**し、「2022〜2024→2025 だけに依存しない評価」をする。

---

### 6. 3 人での役割分担案

- **メンバー A：データ & 整形担当**
  - `pybaseball` で各年の成績を取得。
  - playerid で選手を紐づけ、2022〜2024 を横に並べて 1 行にするテーブルを作る。
  - 欠損・重複の簡単な処理。
- **メンバー B：前処理 & モデル担当**
  - 特徴量の作成（過去 3 年平均・増減）。
  - ベースライン（3 年平均）と機械学習モデル（回帰 / 分類）の実装。
  - 精度指標（MAE / accuracy など）の計算。
- **メンバー C：EDA & 可視化 & 考察担当**
  - 分布・相関・散布図・誤差分布などの可視化。
  - 「どのタイプの選手でモデルが当たる / 外すか」の整理。
  - 発表用スライド・レポートの作成（面白かった選手のケーススタディを載せる）。

---

### 7. 難易度と発展可能性

- **難易度（初心者 3 人想定）**
  - コア部分は「pandas でテーブル加工 + scikit-learn でシンプルなモデル」というレベルで、  
    `beginner.ipynb` を一度真似していれば十分到達可能。
  - 難しい数式は扱わず、「過去の平均」「トレンド」「誤差」の概念レベルで理解することを目標にする。
- **発展方向**
  - `professional.ipynb` のように、
    - 欠損値の高度な扱い
    - カテゴリカル変数（ポジション・打撃左右など）のエンコーディング
    - クロスバリデーション / グリッドサーチによるハイパーパラメータ調整
  - さらには、WAR や fWAR など「総合指標」を予測対象にして、総合力の予測に挑戦することも可能。

---

### 8. この企画のポイント（先生・メンバー向けまとめ）

- **実データ × 未来予測**
  - 「2025 年シーズンの実成績」と「2022〜2024 年からの予測」を直接比較できるため、  
    **“どれくらい当たったか” が非常に分かりやすい**。
- **機械学習の基本サイクルを時系列要素つきで体験**
  - データ取得 → 整形（複数年を 1 行に）→ EDA → 前処理・特徴量 → モデル → 評価 → 誤差分析  
    という一連の流れを、一つ上のレベルの題材で経験できる。
- **初心者でも工夫ポイントが作りやすい**
  - 「どの指標を使うか」「強打者や改善の定義をどうするか」「ベースラインをどう決めるか」など、  
    コード以外の工夫で差がつくポイントが多く、3 人それぞれのアイデアを活かしやすい。

この「来季活躍予測」企画と、`plan/plan.md` の「1 年分の強打者予測」企画を組み合わせると、  
**「まず単年の予測で基礎を学び、その延長として multi-year → next-year の予測につなげる」**というきれいなストーリーにできます。
